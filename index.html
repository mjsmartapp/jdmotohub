<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JD MotoHub</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged, updateProfile } 
      from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js"; // Added updateProfile
    import { getDatabase, ref, push, onValue, set, query, orderByChild, equalTo, get } 
      from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js"; // Added get

    // üîπ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBuTQZ0zwLMLdfzzD2KjEhaGk6BTzJK72s",
      authDomain: "secondhand-803a3.firebaseapp.com",
      databaseURL: "https://secondhand-803a3-default-rtdb.firebaseio.com/",
      projectId: "secondhand-803a3",
      storageBucket: "secondhand-803a3.firebasestorage.app",
      messagingSenderId: "554970268999",
      appId: "1:554970268999:web:d4f418e31c65ef8599f862",
      measurementId: "G-8D44TJDZ24"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let currentUserId = null; 
    let currentUserEmail = null; 
    let currentUserPhone = null; // NEW: Store current user's phone
    let currentUserAddress = null; // NEW: Store current user's address
    let cartCount = 0; 

    // üîπ Utility Functions for Loader Bar
    const loader = document.getElementById('loader-bar');
    window.showLoader = () => { loader.style.display = 'block'; };
    window.hideLoader = () => { loader.style.display = 'none'; };

    // üîπ Toast Notification Function (Top Center)
    window.showToast = (message, type = 'success') => {
      let toastContainer = document.getElementById('toast-container');
      if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        document.body.appendChild(toastContainer);
      }

      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerText = message;
      toastContainer.prepend(toast);

      setTimeout(() => {
        toast.classList.add('fade-out');
        toast.addEventListener('transitionend', () => toast.remove());
      }, 3000); 
    };

    // üõí Load Cart Count from Firebase
    function loadCartCount() {
        if (!currentUserId) return;

        // Listen for real-time changes to the user's cart node
        onValue(ref(db, `users/${currentUserId}/cart`), (snapshot) => {
            const cartItems = snapshot.val();
            cartCount = cartItems ? Object.keys(cartItems).length : 0;
            document.getElementById('cart-count').innerText = cartCount;
        }, {
            onlyOnce: false // Keep listening for changes
        });
    }

    // üõí Add Vehicle to Cart in Firebase
    window.addToCart = async (vehicleKey, vehicleName) => {
        if (!currentUserId) {
            return showToast("Please log in to add items to your cart.", "error");
        }

        try {
            // Set the item in the cart (using set to ensure the key is the vehicle ID)
            await set(ref(db, `users/${currentUserId}/cart/${vehicleKey}`), true);

            showToast(`${vehicleName} added to cart! Total items: ${cartCount + 1}`, "success");
            // loadCartCount handles the UI update via onValue listener
        } catch (err) {
            showToast(`Error adding to cart: ${err.message}`, "error");
        }
    };

    // üì¶ Simulate a Direct Purchase (Log as Order) - MODIFIED AGAIN for Pop-up
    window.buyVehicle = async (vehicleKey, vehicleName, price) => {
        if (!currentUserId) {
            return showToast("Please log in to place an order.", "error");
        }

        // ‚≠ê NEW: Check for required Mobile Number - Keep this check
        if (!currentUserPhone || currentUserPhone.length < 10) {
            showToast("Mobile Number is required to place an order. Please update your profile.", "error");
            showSection('profile'); // Redirect to profile view
            return;
        }

        // Store the details in a global object or data attributes for the modal
        const vehicleData = { key: vehicleKey, name: vehicleName, price: price };
        
        // ** NEW: Open the professional Buy Now Modal **
        window.openBuyNowModal(vehicleData);
    };

    // üí∞ NEW: Actual Order Placement (Moved from old buyVehicle)
    // ‚≠ê MODIFIED: Added parameters for loan/EMI data and payment method from modal
    window.placeOrderFromModal = async (vehicleKey, vehicleName, price, paymentMethod, downPayment, loanTenure, interestRate, loanAmount) => {
        
        // Re-check phone number just in case
        if (!currentUserPhone || currentUserPhone.length < 10) {
            showToast("Mobile Number is required to place an order. Please update your profile.", "error");
            showSection('profile');
            closeBuyNowModal(); // Close modal if redirecting
            return;
        }

        showLoader(); // Show loader during purchase

        try {
            const orderRef = push(ref(db, `users/${currentUserId}/orders`));
            await set(orderRef, {
                vehicleKey: vehicleKey,
                vehicleName: vehicleName,
                price: price,
                timestamp: new Date().toISOString(),
                status: "processing",
                // ‚≠ê NEW: Include Payment Method
                paymentMethod: paymentMethod, // e.g., 'full_paid' or 'emi'
                // ‚≠ê MODIFIED: Include EMI/Loan Data from modal
                loanInfo: {
                    // Only include loan details if the payment method is EMI
                    downPayment: paymentMethod === 'emi' ? (parseInt(downPayment) || 0) : 0, 
                    loanTenure: paymentMethod === 'emi' ? (parseInt(loanTenure) || 0) : 0,
                    interestRate: paymentMethod === 'emi' ? (parseFloat(interestRate) || 0) : 0,
                    loanAmount: paymentMethod === 'emi' ? (parseInt(loanAmount) || 0) : 0 // Use the calculated loan amount
                },
                // Include current contact info for the order record
                buyerInfo: { 
                    name: auth.currentUser.displayName,
                    email: currentUserEmail,
                    phone: currentUserPhone,
                    address: currentUserAddress || 'Not Provided'
                }
            });
            showToast(`Order placed for ${vehicleName} (‚Çπ${parseInt(price).toLocaleString('en-IN')})!`, "success");
            closeBuyNowModal(); // Close after successful order
            showSection('order'); // Show orders page
        } catch (err) {
            showToast(`Error placing order: ${err.message}`, "error");
        } finally {
            hideLoader(); // Hide loader after completion
        }
    }


    // üè¶ NEW: EMI/Loan Calculator Logic (Simplified Example)
    window.calculateEMI = (principal, rate, years) => {
        if (principal <= 0 || rate <= 0 || years <= 0) return 0;

        const monthlyRate = (rate / 100) / 12; // Annual rate to monthly rate
        const numberOfPayments = years * 12;
        
        // EMI formula: P * r * (1 + r)^n / ((1 + r)^n - 1)
        const emi = principal * monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments) / 
                    (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
                    
        return emi;
    }

    // 
    // ‚≠ê NEW MODAL FUNCTIONS 
    //
    window.openBuyNowModal = (vehicleData) => {
        const modal = document.getElementById('buyNowModal');
        const overlay = document.getElementById('buyNowOverlay');
        
        const price = parseInt(vehicleData.price);
        const formattedPrice = price.toLocaleString('en-IN');
        
        // 1. Update Modal Content
        document.getElementById('modalVehicleName').innerText = vehicleData.name;
        document.getElementById('modalVehiclePrice').innerText = `‚Çπ${formattedPrice}`;
        
        // ‚≠ê MODIFIED: Set default payment option to 'emi' for initial calculation
        const paymentOptionSelect = document.getElementById('modalPaymentOption');
        if (paymentOptionSelect) {
            paymentOptionSelect.value = 'emi'; // Default to EMI to show calculation first
        }

        // Set a default down payment (e.g., min of 20% or max of 50000)
        document.getElementById('modalDownPayment').value = Math.min(price * 0.20, 50000).toFixed(0); 
        document.getElementById('modalLoanAmountDisplay').innerText = `‚Çπ${price.toLocaleString('en-IN')}`; // Initial loan amount

        // Store keys for final action
        modal.dataset.vehicleKey = vehicleData.key;
        modal.dataset.vehicleName = vehicleData.name;
        modal.dataset.vehiclePrice = vehicleData.price;

        // 2. Calculate initial EMI and adjust view based on default 'emi'
        window.updateEMICalculation(); 

        // 3. Show Modal
        modal.classList.add('open');
        overlay.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Prevent scrolling background
    }

    window.closeBuyNowModal = () => {
        document.getElementById('buyNowModal').classList.remove('open');
        document.getElementById('buyNowOverlay').style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    window.updateEMICalculation = () => {
        const modal = document.getElementById('buyNowModal');
        // Ensure modal and dataset price exist before proceeding
        if (!modal || !modal.dataset.vehiclePrice) return { loanAmount: 0, emi: 0 }; 

        const price = parseInt(modal.dataset.vehiclePrice);

        // ‚≠ê NEW: Read Payment Option and manage visibility
        const paymentOption = document.getElementById('modalPaymentOption').value;
        const emiSection = document.getElementById('emiArrangementSection');
        
        let effectiveDownPayment = 0;
        let loanAmount = 0;
        let emi = 0;
        let loanTenure = 0;
        let interestRate = 0;

        if (paymentOption === 'full_paid') {
            // Full Paid: Hide EMI section, Loan amount is 0, Button text changes
            emiSection.style.display = 'none';
            document.getElementById('modalLoanAmountDisplay').innerText = `‚Çπ0`;
            document.getElementById('modalMonthlyEMI').innerText = 'N/A';
            document.getElementById('modalConfirmOrder').innerText = 'Confirm Full Payment Order';
            
            // Return 0 for loan details
            return { loanAmount: 0, emi: 0 };

        } else { // paymentOption === 'emi'
            // EMI/Loan: Show EMI section, calculate loan details
            emiSection.style.display = 'block';

            const downPaymentInput = document.getElementById('modalDownPayment');
            const downPayment = parseInt(downPaymentInput.value) || 0;
            
            // Cap down payment at the vehicle price
            effectiveDownPayment = Math.min(downPayment, price);
            downPaymentInput.value = effectiveDownPayment.toFixed(0); 


            loanTenure = parseInt(document.getElementById('modalLoanTenure').value) || 12;
            interestRate = parseFloat(document.getElementById('modalInterestRate').value) || 10;
            
            loanAmount = Math.max(0, price - effectiveDownPayment);
            emi = calculateEMI(loanAmount, interestRate, loanTenure / 12); // Tenure is in months, formula uses years
            
            // Update display elements
            document.getElementById('modalLoanAmountDisplay').innerText = `‚Çπ${loanAmount.toLocaleString('en-IN')}`;
            document.getElementById('modalMonthlyEMI').innerText = emi > 0 ? `‚Çπ${Math.round(emi).toLocaleString('en-IN')}` : '‚Çπ0';
            
            // Update checkout button text/action
            document.getElementById('modalConfirmOrder').innerText = loanAmount > 0 ? 'Arrange Loan & Order' : 'Confirm Cash Order';
            
            // Return calculated values
            return { 
                loanAmount, 
                emi, 
                downPayment: effectiveDownPayment, 
                loanTenure, 
                interestRate 
            };
        }
    }

    // ‚≠ê MODIFIED: Collects loan/EMI data and payment method from modal fields before placing the order.
    window.confirmBuyNow = () => {
        const modal = document.getElementById('buyNowModal');
        const key = modal.dataset.vehicleKey;
        const name = modal.dataset.vehicleName;
        const price = modal.dataset.vehiclePrice;
        
        // ‚≠ê NEW: Read Payment Option
        const paymentMethod = document.getElementById('modalPaymentOption').value;

        if (paymentMethod === 'full_paid') {
            // Full Paid - All loan related fields are 0
            showToast("Confirming order for full payment (Cash/Transfer).", "warning");
            window.placeOrderFromModal(key, name, price, paymentMethod, 0, 0, 0, 0);
            return;
        }

        // EMI/Loan path
        const { loanAmount } = window.updateEMICalculation(); // loanAmount is correctly calculated here
        
        // ‚≠ê NEW: Collect Modal Inputs
        const downPayment = document.getElementById('modalDownPayment').value;
        const loanTenure = document.getElementById('modalLoanTenure').value;
        const interestRate = document.getElementById('modalInterestRate').value;

        if (loanAmount > 0) {
             // Inform user about loan request
             showToast("Loan arrangement request sent. Proceeding to place the provisional order.", "warning");
        }
        
        // Proceed with the actual order placement - PASS NEW DATA
        window.placeOrderFromModal(key, name, price, paymentMethod, downPayment, loanTenure, interestRate, loanAmount);
    }

    // üõí NEW: Load Cart Items
    window.loadCartItems = () => {
        const cartList = document.getElementById("cartItemsList");
        const cartSummary = document.getElementById("cartSummary");
        cartList.innerHTML = ''; // Clear previous content
        let totalCartPrice = 0;
        let itemsInCart = 0;

        if (!currentUserId) {
            document.getElementById('cart-count-display').innerText = 0;
            cartList.innerHTML = '<p class="empty-state">Please log in to view your shopping cart.</p>';
            cartSummary.innerHTML = '<p class="total-price-text">Total: <span>‚Çπ0</span></p>';
            document.getElementById('checkoutButton').disabled = true;
            return;
        }

        const cartRef = ref(db, `users/${currentUserId}/cart`);
        // Use an onValue listener to react to real-time changes
        onValue(cartRef, async (snapshot) => {
            const cartKeys = snapshot.val();
            itemsInCart = cartKeys ? Object.keys(cartKeys).length : 0;
            document.getElementById('cart-count-display').innerText = itemsInCart;
            cartList.innerHTML = '';
            totalCartPrice = 0;

            if (itemsInCart === 0) {
                cartList.innerHTML = '<p class="empty-state">Your cart is empty. Start shopping!</p>';
                cartSummary.innerHTML = '<p class="total-price-text">Total: <span>‚Çπ0</span></p>';
                document.getElementById('checkoutButton').disabled = true;
                return;
            }

            document.getElementById('checkoutButton').disabled = false;

            // Fetch details for each cart item
            const vehiclePromises = Object.keys(cartKeys).map(key => new Promise((resolve, reject) => {
                // Fetch vehicle details only once to get current price/details
                onValue(ref(db, `vehicles/${key}`), (vehicleSnapshot) => {
                    const v = vehicleSnapshot.val();
                    if (v && v.status === 'approved') {
                        v.key = vehicleSnapshot.key;
                        resolve(v);
                    } else {
                        // Item might have been removed or unapproved
                        resolve(null); 
                    }
                }, { onlyOnce: true });
            }));

            const vehicles = (await Promise.all(vehiclePromises)).filter(v => v !== null);

            vehicles.forEach(v => {
                const displayPrice = v.adminPrice || v.price || 0;
                const formattedPrice = parseInt(displayPrice).toLocaleString('en-IN');
                totalCartPrice += parseInt(displayPrice);

                const cartItem = document.createElement("div");
                cartItem.className = "cart-item-card";
                cartItem.innerHTML = `
                    <div class="item-image" style="background-image: url('${v.img}');"></div>
                    <div class="item-details">
                        <h3>${v.name}</h3>
                        <p class="item-specs">Year: ${v.year} | ${v.km} km</p>
                    </div>
                    <p class="item-price">‚Çπ${formattedPrice}</p>
                    <div class="item-actions">
                        <button class="remove-btn" onclick="removeFromCart('${v.key}', '${v.name}')">Remove</button>
                    </div>
                `;
                cartList.appendChild(cartItem);
            });

            cartSummary.innerHTML = `<p class="total-price-text">Subtotal: <span>‚Çπ${totalCartPrice.toLocaleString('en-IN')}</span></p>
                                     <p class="total-price-text">Tax: <span>‚Çπ0</span></p>
                                     <div style="border-top: 1px solid var(--border-color); margin-top: 10px; padding-top: 10px;">
                                        <p class="total-price-text">Total: <span style="font-size: 26px;">‚Çπ${totalCartPrice.toLocaleString('en-IN')}</span></p>
                                     </div>`;

        }, { onlyOnce: false }); // Keep listening for changes (e.g., if another tab adds an item)
    };

    // üõí NEW: Remove item from cart
    window.removeFromCart = async (vehicleKey, vehicleName) => {
        if (!currentUserId) return;
        try {
            await set(ref(db, `users/${currentUserId}/cart/${vehicleKey}`), null);
            showToast(`${vehicleName} removed from cart.`, "success");
        } catch (err) {
            showToast(`Error removing item: ${err.message}`, "error");
        }
    };

    // üí∞ NEW: Simulate Checkout (Modified to check for phone number)
    window.checkoutCart = async () => {
        if (!currentUserId) return;

        // ‚≠ê NEW: Check for required Mobile Number for checkout too
        if (!currentUserPhone || currentUserPhone.length < 10) {
            showToast("Mobile Number is required for checkout. Please update your profile.", "error");
            showSection('profile'); // Redirect to profile view
            return;
        }

        showLoader(); // Show loader during checkout

        try {
            // For a real app, you would move items to orders, handle payment, etc.
            // Here, we simulate by logging the event and clearing the cart.
            await set(ref(db, `users/${currentUserId}/cart`), null);
            showToast("Checkout Successful! Your order has been placed and is being processed.", "success");
            showSection('order'); // Redirect user to orders page
        } catch (err) {
            showToast(`Error during checkout: ${err.message}`, "error");
        } finally {
            hideLoader();
        }
    }


    // üì¶ NEW: Load Orders History
    window.loadOrdersHistory = () => {
        const ordersTableBody = document.getElementById("ordersTableBody");
        ordersTableBody.innerHTML = '<tr><td colspan="5">Loading your orders...</td></tr>';

        if (!currentUserId) {
            ordersTableBody.innerHTML = '<tr><td colspan="5">Please log in to view your order history.</td></tr>';
            return;
        }

        // Listen for user's orders
        onValue(ref(db, `users/${currentUserId}/orders`), (snapshot) => {
            ordersTableBody.innerHTML = "";
            let recordsFound = 0;
            const orders = [];

            snapshot.forEach((child) => {
                const order = child.val();
                order.orderId = child.key;
                orders.push(order);
            });

            // Sort by timestamp (newest first)
            orders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            orders.forEach((order) => {
                recordsFound++;
                const formattedPrice = parseInt(order.price || 0).toLocaleString('en-IN');
                // Format date nicely
                const orderDate = new Date(order.timestamp).toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });

                let statusClass = '';
                let statusText = order.status;

                if (order.status === 'processing') {
                    statusClass = 'pending'; 
                } else if (order.status === 'shipped') {
                    statusClass = 'approved'; 
                } else if (order.status === 'delivered') {
                    statusClass = 'approved'; 
                    statusText = 'Delivered';
                } else if (order.status === 'cancelled') {
                    statusClass = 'rejected';
                }
                
                // Show Loan/EMI details if available
                const loanDetails = order.loanInfo && order.loanInfo.loanAmount > 0 
                    ? `<br><small>Loan: ‚Çπ${order.loanInfo.loanAmount.toLocaleString('en-IN')} | DP: ‚Çπ${order.loanInfo.downPayment.toLocaleString('en-IN')}</small>`
                    : '';
                
                // Display payment method
                const paymentDisplay = order.paymentMethod === 'full_paid' ? 'Full Paid' : 'EMI';

                const row = `
                    <tr>
                        <td data-label="Order ID">#${order.orderId.substring(0, 8).toUpperCase()}</td>
                        <td data-label="Vehicle">${order.vehicleName}</td>
                        <td data-label="Price">‚Çπ${formattedPrice}${loanDetails}<br><small>Method: ${paymentDisplay}</small></td>
                        <td data-label="Date">${orderDate}</td>
                        <td data-label="Status"><span class="status-badge ${statusClass}">${statusText.charAt(0).toUpperCase() + statusText.slice(1)}</span></td>
                    </tr>
                `;
                ordersTableBody.insertAdjacentHTML("beforeend", row);
            });

            if (recordsFound === 0) {
                ordersTableBody.innerHTML = '<tr><td colspan="5">You have no orders yet. Click "Buy Now" on a vehicle to place an order.</td></tr>';
            }
        }, (error) => {
            console.error("Error loading order history:", error);
            ordersTableBody.innerHTML = '<tr><td colspan="5">Error loading order history.</td></tr>';
        });
    };

    // ‚≠ê NEW: Function to load and set user profile data from DB
    async function loadUserProfile(user) {
        try {
            const profileSnapshot = await get(ref(db, `users/${user.uid}/profile`));
            const profileData = profileSnapshot.val();

            // Set global user variables
            currentUserPhone = profileData?.phone || null;
            currentUserAddress = profileData?.address || null;

            // Set Profile View fields
            document.getElementById("profile-input-name").value = user.displayName || "";
            document.getElementById("profile-input-phone").value = currentUserPhone || "";
            document.getElementById("profile-input-address").value = currentUserAddress || "";
            document.getElementById("profile-input-email").value = user.email || ""; // Readonly email

            // ‚≠ê THE FIX: Set the profile photo source
            document.getElementById("userPhotoProfile").src = user.photoURL || "https://static-00.iconduck.com/assets.00/user-avatar-icon-512x512-nghi2896.png";

            // Set display fields
            document.getElementById("userNameProfile").innerText = user.displayName || "User";
            document.getElementById("userEmailProfile").innerText = user.email;
            document.getElementById("userPhoneProfile").innerText = currentUserPhone || "N/A (Required for Orders)";
            document.getElementById("userAddressProfile").innerText = currentUserAddress || "N/A";

        } catch (error) {
            console.error("Error loading user profile:", error);
        }
    }

    // ‚≠ê NEW: Function to update user profile data in Auth and DB
    window.updateUserProfile = async () => {
        if (!currentUserId) return;

        const newName = document.getElementById("profile-input-name").value.trim();
        const newPhone = document.getElementById("profile-input-phone").value.trim();
        const newAddress = document.getElementById("profile-input-address").value.trim();

        if (!newName || !newPhone || newPhone.length < 10) {
            return showToast("Name and a valid Mobile Number are required!", "warning");
        }

        showLoader();

        try {
            // 1. Update Firebase Authentication Profile (for display name)
            await updateProfile(auth.currentUser, {
                displayName: newName
            });

            // 2. Update Realtime Database Profile (for phone, address, etc.)
            const profileData = {
                name: newName,
                phone: newPhone,
                address: newAddress,
                lastUpdated: new Date().toISOString()
            };
            await set(ref(db, `users/${currentUserId}/profile`), profileData);

            // Update local variables and re-run UI updates
            await loadUserProfile(auth.currentUser); 

            // Re-populate sell form fields
            document.getElementById("selleremail").value = auth.currentUser.email;
            document.getElementById("sellername").value = newName;
            document.getElementById("sellerphone").value = newPhone;


            showToast("Profile updated successfully!", "success");

        } catch (error) {
            showToast(`Error updating profile: ${error.message}`, "error");
        } finally {
            hideLoader();
        }
    };


    // üîí Protect Dashboard & Load User Info - MODIFIED
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "index.html";
      } else {
        currentUserId = user.uid; // Store UID
        currentUserEmail = user.email; 

        // Load the persistent cart count AND the profile data
        loadCartCount();
        loadUserProfile(user); 

        // Drawer Profile content
        document.getElementById("userPhotoDrawer").src = user.photoURL || "https://static-00.iconduck.com/assets.00/user-avatar-icon-512x512-nghi2896.png";
        document.getElementById("userNameDrawer").innerText = user.displayName || "User";
        document.getElementById("userEmailDrawer").innerText = user.email;


        // Pre-fill seller details on the Sell page (will be overwritten by loadUserProfile)
        document.getElementById("selleremail").value = user.email;
        document.getElementById("sellername").value = user.displayName || "";
      }
    });

    // üîπ Logout Function
    window.logout = () => {
      signOut(auth).then(() => {
        showToast("Logged out successfully.", "success");
        window.location.href = "index.html";
      });
    };

    //
    // --- NEW IMAGE PICKER + PREVIEW LOGIC (Base64 conversion, no Firebase Storage) ---
    //
    // We'll keep selectedImages as an array of objects: { id, src, kind, size } where kind is 'file' or 'url'
    //
    const selectedImages = [];
    let imageIdCounter = 0;

    // Handle files selected from file input -> convert to dataURL (Base64) and add to selectedImages
    window.handleFileSelection = (event) => {
      const files = Array.from(event.target.files || []);
      if (files.length === 0) return;
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          selectedImages.push({ id: `img_${imageIdCounter++}`, src: e.target.result, kind: 'file' });
          renderImagePreviews();
        };
        reader.readAsDataURL(file);
      });
      // clear file input so same file can be re-selected if needed
      event.target.value = "";
    };

    // Add image URLs entered manually (comma separated) into selectedImages as kind: 'url'
    window.addImageURLsToSelection = () => {
      const urlInput = document.getElementById("vimages").value.trim();
      if (!urlInput) return;
      const urls = urlInput.split(",").map(u => u.trim()).filter(u => u !== "");
      urls.forEach(u => selectedImages.push({ id: `img_${imageIdCounter++}`, src: u, kind: 'url' }));
      document.getElementById("vimages").value = "";
      renderImagePreviews();
    };

    // Remove image by id
    window.removeSelectedImage = (id) => {
      const idx = selectedImages.findIndex(i => i.id === id);
      if (idx !== -1) {
        selectedImages.splice(idx, 1);
        renderImagePreviews();
      }
    };

    // Render preview thumbnails with remove button
    function renderImagePreviews() {
      const container = document.getElementById("imagePreviewContainer");
      if (!container) return;
      container.innerHTML = "";
      selectedImages.forEach(img => {
        const wrapper = document.createElement("div");
        wrapper.className = "preview-wrapper";
        wrapper.innerHTML = `
          <img src="${img.src}" alt="preview" loading="lazy" />
          <button type="button" class="preview-remove" onclick="removeSelectedImage('${img.id}')">‚úï</button>
          <div class="preview-kind">${img.kind === 'file' ? 'file' : 'url'}</div>
        `;
        container.appendChild(wrapper);
      });
    }

    //
    // üîπ Add Vehicle (sent to pending approval) - UPDATED to combine selectedImages + manual input
    //
    window.addVehicle = () => {
      // Seller Details
      const sellerName = document.getElementById("sellername").value.trim();
      const sellerEmail = document.getElementById("selleremail").value.trim();
      const sellerPhone = document.getElementById("sellerphone").value.trim();
      const sellerAltPhone = document.getElementById("selleraltphone").value.trim();
      const sellerAddress = document.getElementById("selleraddress").value.trim();

      // Vehicle Details
      const name = document.getElementById("vname").value.trim();
      const description = document.getElementById("vdescription").value.trim(); 
      const type = document.getElementById("vtype").value;
      const year = document.getElementById("vyear").value.trim();
      const km = document.getElementById("vkm").value.trim();
      const price = document.getElementById("vprice").value.trim();

      // Also allow user to quickly add any remaining URLs into selection before submit
      addImageURLsToSelection();

      // Build combined vimages string from selectedImages (preserve order)
      const combinedImageSrcs = selectedImages.map(i => i.src);
      const imagesInput = combinedImageSrcs.join(","); 
      const img = combinedImageSrcs[0] || "https://images.unsplash.com/photo-1596557802874-954848074902?fit=crop&w=600&h=300&q=80";


      // Updated validation check
      if (!sellerName || !sellerEmail || !sellerPhone || !sellerAddress || !name || !description || !year || !km || !price) {
        showToast("Please fill all required fields (Seller and Vehicle details)!", "warning");
        return;
      }

      if (combinedImageSrcs.length === 0) {
        showToast("Please add at least one image URL or file before submitting.", "warning");
        return;
      }

      const vehicleData = {
        // Seller Information Structure
        seller: {
            name: sellerName,
            email: sellerEmail,
            phone: sellerPhone,
            altPhone: sellerAltPhone,
            address: sellerAddress
        },
        // Vehicle Information
        name,
        description, 
        type,
        year,
        km,
        price,
        img, 
        vimages: imagesInput, 
        status: "pending",
        submittedBy: currentUserEmail 
      };

      showLoader();
      push(ref(db, "vehicles/"), vehicleData)
        .then(() => {
          showToast("Vehicle submitted for admin approval!", "success");
          // Clear form fields
          document.querySelectorAll("#sell-view input, #sell-view textarea").forEach(i => i.value = "");
          document.getElementById("vtype").value = "bike";
          // Clear previews
          selectedImages.length = 0;
          renderImagePreviews();
          // Re-populate seller details
          if(auth.currentUser) {
              document.getElementById("selleremail").value = auth.currentUser.email;
              document.getElementById("sellername").value = auth.currentUser.displayName || "";
          }
          showSection('history'); // Show sell history after submission
        })
        .catch((err) => {
          showToast(`Error submitting vehicle: ${err.message}`, "error");
        })
        .finally(() => {
          hideLoader();
        });
    };

    // üîπ Load Approved Vehicles (Home View) - UNCHANGED
    const vehicleGrid = document.getElementById("vehicleGrid");
    onValue(ref(db, "vehicles/"), (snapshot) => {
      vehicleGrid.innerHTML = "";
      const vehicles = [];
      snapshot.forEach((child) => {
        const v = child.val();
        const vehicleKey = child.key; 
        if (v.status === "approved") {
          // Use adminPrice as the final approved selling price, falling back to original price.
          const displayPrice = v.adminPrice || v.price || 0; 
          
          const card = document.createElement("div");
          card.className = "card";
          card.dataset.type = v.type;
          // Store searchable/sortable data in data-attributes
          card.dataset.name = v.name;
          card.dataset.year = v.year;
          card.dataset.km = v.km;
          card.dataset.price = displayPrice; // Store raw price for search/sort
          
          card.innerHTML = `
            <div class="card-image" style="background-image: url('${v.img}');"></div>
            <div class="card-content">
              <h3>${v.name}</h3>
              <p class="specs">Year: <span>${v.year}</span> | ${v.km} <span>km</span></p>
              <p class="description">${(v.description || 'No description provided.').substring(0, 70)}...</p>
              <p class="price">Price: <span>‚Çπ${parseInt(displayPrice).toLocaleString('en-IN')}</span></p>
              <div class="card-actions">
                  <button class="action-btn buy-btn" onclick="buyVehicle('${vehicleKey}', '${v.name}', '${displayPrice}')">Buy Now</button>
                  <button class="action-btn cart-btn" onclick="addToCart('${vehicleKey}', '${v.name}')">Add to Cart</button>
              </div>
            </div>
          `;
          vehicleGrid.appendChild(card);
        }
      });
      
      // Initial filter/sort on load
      window.filterAndSortVehicles();
    });

    // üîπ Load Sell History
    window.loadSellHistory = async () => {
      const historyTableBody = document.getElementById("historyTableBody");
      historyTableBody.innerHTML = "<tr><td colspan='6'>Loading your submissions...</td></tr>";

      if (!currentUserEmail) {
        historyTableBody.innerHTML = "<tr><td colspan='6'>Please log in to view your selling history.</td></tr>";
        return;
      }

      try {
        // Query vehicles submitted by the current user
        const vehiclesQuery = query(ref(db, `vehicles`), orderByChild('submittedBy'), equalTo(currentUserEmail));
        
        onValue(vehiclesQuery, (snapshot) => {
          historyTableBody.innerHTML = "";
          let recordsFound = 0;
          const vehicles = [];

          snapshot.forEach((child) => {
            const v = child.val();
            v.key = child.key;
            vehicles.push(v);
          });
          
          // Sort by timestamp (if available, newest first) - assuming they might add a timestamp later
          vehicles.sort((a, b) => {
              const dateA = a.timestamp ? new Date(a.timestamp) : new Date(0);
              const dateB = b.timestamp ? new Date(b.timestamp) : new Date(0);
              return dateB - dateA;
          });

          vehicles.forEach((v) => {
            recordsFound++;
            
            const finalPrice = v.adminPrice ? `‚Çπ${parseInt(v.adminPrice).toLocaleString('en-IN')}` : 'N/A';
            let statusClass = '';
            let statusText = v.status;

            if (v.status === 'approved') {
                statusClass = 'approved';
                statusText = 'Approved (Live)';
            } else if (v.status === 'pending') {
                statusClass = 'pending';
                statusText = 'Pending Admin Review';
            } else if (v.status === 'rejected') {
                statusClass = 'rejected';
                statusText = 'Rejected by Admin';
            } else {
                statusClass = 'unknown';
                statusText = 'Unknown Status';
            }

            const row = `
                <tr>
                    <td data-label="Vehicle Name">${v.name}</td>
                    <td data-label="Type">${v.type}</td>
                    <td data-label="Your Price">‚Çπ${parseInt(v.price || 0).toLocaleString('en-IN')}</td>
                    <td data-label="Final Price">${finalPrice}</td>
                    <td data-label="Status"><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td data-label="Action"><button class="action-btn view-details-btn" onclick="showToast('Details for ${v.name} - Status: ${statusText}', 'success')">View Details</button></td>
                </tr>
            `;
            historyTableBody.insertAdjacentHTML("beforeend", row);
          });

          if (recordsFound === 0) {
            historyTableBody.innerHTML = "<tr><td colspan='6'>You have not submitted any vehicles yet.</td></tr>";
          }
        }, (error) => {
          console.error("Error loading sell history:", error);
          historyTableBody.innerHTML = "<tr><td colspan='6'>Error loading history.</td></tr>";
        });
      } catch (err) {
        console.error("Error during history query setup:", err);
        historyTableBody.innerHTML = "<tr><td colspan='6'>An error occurred.</td></tr>";
      }
    };

    // üîπ Drawer Toggle Function
    window.toggleDrawer = () => {
      const drawer = document.getElementById('drawer-menu');
      const overlay = document.getElementById('drawer-overlay');
      const isVisible = drawer.classList.toggle('open');
      overlay.style.display = isVisible ? 'block' : 'none';
      document.body.style.overflow = isVisible ? 'hidden' : 'auto';
    }

    // üîπ Section Visibility Manager - UNCHANGED
    window.showSection = (sectionId) => {
      // Close the drawer if open
      const drawer = document.getElementById('drawer-menu');
      const overlay = document.getElementById('drawer-overlay');
      if(drawer.classList.contains('open')) {
        window.toggleDrawer();
      }

      // Hide all content sections
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.add('hidden');
      });

      // Show the requested section
      const activeSection = document.getElementById(sectionId);
      if (activeSection) {
        activeSection.classList.remove('hidden');
        window.scrollTo(0, 0); // Scroll to top on section change
      }
      
      // Update active nav item
      document.querySelectorAll('.drawer-nav .nav-item').forEach(item => {
          item.classList.remove('active');
          if (item.dataset.section === sectionId) {
              item.classList.add('active');
          }
      });

      // Trigger specific load functions
      if (sectionId === 'cart') {
          window.loadCartItems();
      } else if (sectionId === 'order') {
          window.loadOrdersHistory();
      } else if (sectionId === 'history') {
          window.loadSellHistory();
      } else if (sectionId === 'profile' && auth.currentUser) {
          // Ensure profile data is fresh when profile section is shown
          loadUserProfile(auth.currentUser);
      }
    };

    // üîπ Home Page Filter & Sort Logic - UNCHANGED
    window.filterAndSortVehicles = () => {
      const vehicleGridElement = document.getElementById('vehicleGrid');
      const cards = Array.from(vehicleGridElement.querySelectorAll('.card'));
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      const type = document.getElementById('type-filter').value;
      const sortBy = document.getElementById('sort-by').value;

      // 1. FILTERING
      cards.forEach(card => {
        const matchesSearch = card.dataset.name.toLowerCase().includes(searchTerm) || 
                              card.dataset.year.includes(searchTerm);
        const matchesType = (type === 'all' || card.dataset.type === type);

        // Temporarily hide non-matching elements (will be re-shown after sorting)
        card.style.display = (matchesSearch && matchesType) ? "grid" : "none";
      });

      // Filter only the *visible* cards for sorting
      let visibleCards = cards.filter(card => card.style.display !== 'none');

      // 2. SORTING
      visibleCards.sort((a, b) => {
        const aVal = a.dataset[sortBy.split('_')[0]];
        const bVal = b.dataset[sortBy.split('_')[0]];
        const direction = sortBy.split('_')[1];

        if (sortBy === 'default') return 0; // No sorting

        // Numeric fields (Year, KM, Price)
        if (sortBy.includes('year') || sortBy.includes('km') || sortBy.includes('price')) {
          const numA = parseFloat(aVal);
          const numB = parseFloat(bVal);
          if (direction === 'asc') return numA - numB;
          return numB - numA;
        }

        // String fields (Name)
        if (sortBy.includes('name')) {
          const nameA = aVal.toLowerCase();
          const nameB = bVal.toLowerCase();
          if (direction === 'asc') return nameA.localeCompare(nameB);
          return nameB.localeCompare(nameA);
        }

        return 0;
      });

      // 3. RE-RENDERING (to apply sort order)
      // Append the sorted cards back to the grid. The DOM function appendChild automatically moves existing elements.
      visibleCards.forEach(card => {
        vehicleGridElement.appendChild(card);
        // Ensure they are visible after re-appending
        card.style.display = 'grid';
      });
    };

    // Set initial view
    document.addEventListener('DOMContentLoaded', () => {
      showSection('home');
      hideLoader(); // Ensure loader is hidden on load

      // ‚≠ê NEW MODAL EVENT LISTENERS (Updated to also attach to payment option change) ‚≠ê
      document.getElementById('modalDownPayment')?.addEventListener('input', window.updateEMICalculation);
      document.getElementById('modalLoanTenure')?.addEventListener('change', window.updateEMICalculation);
      document.getElementById('modalInterestRate')?.addEventListener('change', window.updateEMICalculation);
      // NEW LISTENER: Recalculate EMI when payment option changes
      document.getElementById('modalPaymentOption')?.addEventListener('change', window.updateEMICalculation); 
    });

  </script>

  <style>
    :root {
      --primary-color: #007bff;
      --secondary-color: #6c757d;
      --danger-color: #dc3545;
      --success-color: #28a745;
      --warning-color: #ffc107;

      --text-color: #343a40;
      --text-light: #6c757d;
      --background-color: #f8f9fa;
      --card-bg: #ffffff;
      --border-color: #e9ecef;
      --shadow-color: rgba(0, 0, 0, 0.05);

      --success-bg: #d4edda;
      --error-bg: #f8d7da;
      --warning-bg: #fff3cd;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    body {
      background-color: var(--background-color);
      color: var(--text-color);
      padding-top: 60px; /* Space for fixed header */
      transition: background-color 0.3s;
    }

    /* --- LOADER BAR --- */
    #loader-bar {
        position: fixed;
        top: 60px;
        left: 0;
        width: 100%;
        height: 3px;
        background-color: var(--primary-color);
        z-index: 10001;
        display: none;
        overflow: hidden;
    }
    #loader-bar::before {
        content: '';
        position: absolute;
        top: 0;
        left: -50%;
        width: 50%;
        height: 100%;
        background: linear-gradient(90deg, transparent, white, transparent);
        animation: loading 1.5s infinite;
    }
    @keyframes loading {
        0% { left: -50%; }
        100% { left: 100%; }
    }

    /* --- TOAST NOTIFICATION --- */
    #toast-container {
      position: fixed;
      top: 70px; /* Below header */
      left: 50%;
      transform: translateX(-50%);
      z-index: 20000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      opacity: 1;
      transition: opacity 0.5s, transform 0.5s;
      min-width: 250px;
      text-align: center;
      font-size: 14px;
      font-weight: 500;
    }

    .toast.success {
      background-color: var(--success-bg);
      color: var(--success-color);
      border: 1px solid var(--success-color);
    }

    .toast.error {
      background-color: var(--error-bg);
      color: var(--danger-color);
      border: 1px solid var(--danger-color);
    }

    .toast.warning {
      background-color: var(--warning-bg);
      color: var(--warning-color);
      border: 1px solid var(--warning-color);
    }

    .toast.fade-out {
      opacity: 0;
      transform: translate(-50%, -20px);
    }

    /* --- HEADER --- */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background: var(--primary-color);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 10000;
    }

    .header-left {
      display: flex;
      align-items: center;
    }

    header h1 {
      font-size: 20px;
      margin: 0;
      font-weight: 700;
      letter-spacing: 1px;
    }

    #drawer-toggle {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      margin-right: 15px;
      cursor: pointer;
      padding: 5px;
    }

    .header-right {
      display: flex;
      align-items: center;
    }

    .cart-icon {
      font-size: 20px;
      cursor: pointer;
      position: relative;
      padding: 5px;
      margin-left: 15px;
    }

    #cart-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger-color);
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 10px;
      line-height: 1;
      font-weight: 700;
    }
    
    .profile-avatar {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        object-fit: cover;
        margin-left: 15px;
        cursor: pointer;
        border: 2px solid white;
    }

    /* --- DRAWER MENU --- */
    #drawer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10010;
      display: none;
      transition: opacity 0.3s;
    }

    #drawer-menu {
      position: fixed;
      top: 0;
      left: 0;
      width: 300px;
      height: 100%;
      background: var(--card-bg);
      z-index: 10011;
      transform: translateX(-100%);
      transition: transform 0.3s ease-out;
      box-shadow: 2px 0 5px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
    }

    #drawer-menu.open {
      transform: translateX(0);
    }

    .drawer-header {
      padding: 10px 20px;
      display: flex;
      justify-content: flex-end;
      border-bottom: 1px solid var(--border-color);
    }

    .drawer-header button {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-color);
    }

    .drawer-profile {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid var(--border-color);
    }

    .drawer-profile img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 10px;
      border: 3px solid var(--primary-color);
    }

    .drawer-profile h3 {
      font-size: 18px;
      margin: 5px 0;
    }

    .drawer-profile p {
      font-size: 14px;
      color: var(--text-light);
    }

    .drawer-nav {
      flex-grow: 1;
      padding: 10px 0;
    }

    .drawer-nav .nav-item {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      text-decoration: none;
      color: var(--text-color);
      font-size: 16px;
      transition: background 0.2s;
    }

    .drawer-nav .nav-item .icon {
      margin-right: 15px;
      font-size: 20px;
    }

    .drawer-nav .nav-item:hover, .drawer-nav .nav-item.active {
      background: var(--border-color);
      color: var(--primary-color);
      font-weight: 600;
    }

    .drawer-footer {
      padding: 20px;
      border-top: 1px solid var(--border-color);
    }

    .drawer-logout-btn {
      width: 100%;
      background: var(--danger-color);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .drawer-logout-btn:hover {
      background: #c82333;
    }

    main {
      padding: 0 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* --- CONTENT SECTIONS --- */
    .content-section {
      padding-top: 20px;
      min-height: calc(100vh - 80px); /* Fill the viewport */
    }

    .content-section.hidden {
      display: none;
    }

    .section-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-color);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border-color);
    }

    /* Search & Filter Bar */
    .search-filter {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      margin-top: 15px;
    }

    .search-filter input, .search-filter select {
      padding: 10px 15px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 16px;
    }

    .search-filter input {
      flex-grow: 1;
    }

    .search-filter select {
      width: 150px;
      flex-shrink: 0;
    }

    /* Vehicle Grid */
    #vehicleGrid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    /* Vehicle Card */
    .card {
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 4px 12px var(--shadow-color);
      overflow: hidden;
      display: grid;
      grid-template-rows: 200px 1fr;
      transition: transform 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .card-image {
      height: 200px;
      background-size: cover;
      background-position: center;
    }

    .card-content {
      padding: 15px;
      display: flex;
      flex-direction: column;
    }

    .card-content h3 {
      font-size: 18px;
      margin-bottom: 5px;
      color: var(--primary-color);
      font-weight: 700;
    }

    .card-content .specs {
      font-size: 14px;
      color: var(--text-light);
      margin-bottom: 10px;
    }

    .card-content .specs span {
        font-weight: 600;
        color: var(--text-color);
    }

    .card-content .description {
      font-size: 14px;
      margin-bottom: 15px;
      flex-grow: 1;
    }

    .card-content .price {
      font-size: 16px;
      font-weight: 500;
      color: var(--text-color);
      margin-bottom: 15px;
      border-top: 1px solid var(--border-color);
      padding-top: 10px;
    }

    .card-content .price span {
      font-size: 22px;
      font-weight: 700;
      color: var(--danger-color);
      margin-left: 5px;
    }

    .card-actions {
      display: flex;
      gap: 10px;
      margin-top: auto; /* Push actions to the bottom */
    }

    .action-btn {
      flex: 1;
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .buy-btn {
      background: var(--danger-color);
      color: white;
    }

    .buy-btn:hover {
      background: #c82333;
    }

    .cart-btn {
      background: var(--secondary-color);
      color: white;
    }

    .cart-btn:hover {
      background: #5a6268;
    }

    /* --- SELL SECTION --- */
    .sell-form-container {
      max-width: 700px;
      margin: 0 auto 40px auto;
      background: var(--card-bg);
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group.split {
      display: flex;
      gap: 20px;
    }

    .form-group.split > div {
      flex: 1;
    }

    .sell-form-container h3 {
      font-size: 18px;
      margin-top: 25px;
      margin-bottom: 15px;
      color: var(--primary-color);
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 5px;
    }

    .sell-form-container label {
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .sell-form-container input[type="text"], 
    .sell-form-container input[type="email"], 
    .sell-form-container input[type="number"], 
    .sell-form-container textarea, 
    .sell-form-container select {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 16px;
    }

    .sell-form-container textarea {
      resize: vertical;
      min-height: 100px;
    }

    .sell-form-container button {
      background: var(--danger-color);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      width: 100%;
    }

    .sell-form-container button:hover {
      background: #c82333;
    }

    .full-width {
      width: 100%;
    }

    .note {
      display: block;
      font-size: 12px;
      color: var(--text-light);
      margin-top: 5px;
    }

    /* Image Previews */
    .preview-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .preview-wrapper {
      position: relative;
      width: 100px;
      height: 100px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .preview-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .preview-remove {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(220, 53, 69, 0.8);
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      line-height: 1;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-kind {
        position: absolute;
        bottom: 0;
        left: 0;
        background: rgba(0, 123, 255, 0.8);
        color: white;
        padding: 2px 5px;
        font-size: 9px;
        text-transform: uppercase;
    }
    
    /* --- PROFILE SECTION --- */
    .profile-card {
      max-width: 600px;
      margin: 0 auto 40px auto;
      background: var(--card-bg);
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .profile-summary {
      display: flex;
      align-items: center;
      padding-bottom: 20px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .profile-summary img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 20px;
    }
    
    .profile-details h3 {
      margin: 0 0 5px 0;
      font-size: 20px;
      font-weight: 700;
    }
    
    .profile-details p {
      margin: 5px 0;
      font-size: 14px;
      color: var(--text-color);
    }
    
    .profile-details span {
      font-weight: 500;
      color: var(--text-light);
    }
    
    .profile-form label {
      display: block;
      font-weight: 600;
      margin-top: 15px;
      margin-bottom: 5px;
      font-size: 14px;
    }
    
    .profile-form input {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 16px;
    }
    
    .profile-form button {
      background: var(--primary-color);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 25px;
      width: 100%;
    }
    
    .profile-form button:hover {
      background: #0056b3;
    }
    
    /* --- HISTORY / ORDERS TABLES --- */
    .history-table, .orders-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card-bg);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      border-radius: 10px;
      overflow: hidden;
    }

    .history-table th, .orders-table th, 
    .history-table td, .orders-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .history-table th, .orders-table th {
      background: var(--primary-color);
      color: white;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
    }

    .history-table tr:last-child td, .orders-table tr:last-child td {
      border-bottom: none;
    }

    .status-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-badge.pending {
      background-color: var(--warning-bg);
      color: var(--warning-color);
    }

    .status-badge.approved {
      background-color: var(--success-bg);
      color: var(--success-color);
    }

    .status-badge.rejected {
      background-color: var(--error-bg);
      color: var(--danger-color);
    }
    
    .view-details-btn {
        background: var(--primary-color);
        color: white;
        padding: 6px 10px;
        border: none;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
    }

    /* --- CART SECTION --- */
    .cart-container {
      display: flex;
      gap: 30px;
      padding-bottom: 40px;
    }

    .cart-list {
      flex: 3;
      min-width: 0;
    }

    .cart-summary {
      flex: 1;
      max-width: 300px;
      background: var(--card-bg);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      position: sticky;
      top: 80px; /* Stick below the header */
      height: fit-content;
    }

    .cart-summary h3 {
      font-size: 20px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }

    .total-price-text {
      display: flex;
      justify-content: space-between;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .total-price-text span {
      font-weight: 700;
      color: var(--danger-color);
      font-size: 18px;
    }

    #checkoutButton {
      width: 100%;
      background: var(--success-color);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 15px;
      transition: background 0.2s;
    }

    #checkoutButton:disabled {
        background: var(--secondary-color);
        cursor: not-allowed;
    }
    
    #checkoutButton:hover:not(:disabled) {
      background: #1e7e34;
    }

    .cart-item-card {
      display: flex;
      align-items: center;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-bottom: 15px;
      padding: 15px;
      gap: 15px;
    }

    .cart-item-card .item-image {
      width: 80px;
      height: 60px;
      background-size: cover;
      background-position: center;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .cart-item-card .item-details {
      flex-grow: 1;
    }

    .cart-item-card .item-details h3 {
      font-size: 16px;
      margin: 0;
      color: var(--text-color);
    }

    .cart-item-card .item-details .item-specs {
      font-size: 12px;
      color: var(--text-light);
      margin: 3px 0 0 0;
    }

    .cart-item-card .item-price {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary-color);
      margin: 0 20px;
      flex-shrink: 0;
    }

    .cart-item-card .item-actions .remove-btn {
      background: var(--danger-color);
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.2s;
    }

    .cart-item-card .item-actions .remove-btn:hover {
      background: #c82333;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-light);
        font-style: italic;
        background: var(--card-bg);
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    /* --- BUY NOW MODAL --- */
    #buyNowOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 10002;
        display: none;
        transition: opacity 0.3s;
    }

    #buyNowModal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.9);
        background: var(--card-bg);
        border-radius: 10px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        max-width: 500px;
        width: 90%;
        z-index: 10003;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, transform 0.3s;
    }

    #buyNowModal.open {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid var(--border-color);
    }

    .modal-header h3 {
        margin: 0;
        font-size: 18px;
        color: var(--primary-color);
    }

    .modal-header button {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-light);
    }

    .modal-content {
        padding: 20px;
    }

    .modal-price {
        text-align: center;
        font-size: 18px;
        font-weight: 500;
        margin-bottom: 20px;
    }

    .modal-price span {
        font-size: 28px;
        font-weight: 700;
        color: var(--danger-color);
        display: block;
        margin-top: 5px;
    }
    
    .input-group-full-width {
        margin-bottom: 15px;
    }
    
    .input-group-full-width label {
        display: block; 
        font-size: 14px; 
        font-weight: 600; 
        margin-bottom: 5px;
    }
    
    .input-group-full-width select {
        width: 100%; 
        padding: 10px; 
        border: 1px solid var(--border-color); 
        border-radius: 4px; 
        font-size: 15px;
    }


    .loan-arrangement-section {
        border: 1px dashed var(--border-color);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .loan-arrangement-section h4 {
        margin: 0 0 15px 0;
        font-size: 16px;
        font-weight: 600;
        color: var(--primary-color);
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 8px;
    }

    .input-group-modal {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
    }

    .input-group-modal > div {
        flex: 1;
    }

    .input-group-modal label {
        display: block;
        font-size: 12px;
        font-weight: 500;
        margin-bottom: 5px;
        color: var(--text-light);
    }

    .input-group-modal input, .input-group-modal select {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 15px;
    }
    
    .input-group-modal .input-display {
        display: block;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 15px;
        background-color: #f8f9fa;
        font-weight: 600;
    }

    .emi-summary {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        font-size: 16px;
        font-weight: 500;
        border-top: 1px solid var(--border-color);
        margin-top: 10px;
    }

    .emi-summary h4 {
        margin: 0;
        font-size: 18px;
        color: var(--text-color);
        font-weight: 600;
    }

    .emi-value {
        font-size: 22px;
        color: var(--danger-color);
        font-weight: 700;
    }

    .modal-footer {
        border-top: 1px solid var(--border-color);
        padding-top: 15px;
    }

    #modalConfirmOrder {
        width: 100%;
        background: var(--success-color);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    #modalConfirmOrder:hover {
        background: #1e7e34;
    }
    
    .modal-note {
        text-align: center;
        font-size: 12px;
        color: var(--text-light);
        margin-top: 10px;
    }


    /* --- MEDIA QUERIES --- */
    @media (max-width: 900px) {
      .cart-container {
        flex-direction: column;
      }

      .cart-summary {
        width: 100%;
        max-width: none;
        position: static; /* Remove sticky on small screens */
      }

      .search-filter {
        flex-direction: column;
      }

      .search-filter select {
        width: 100%;
      }
    }

    @media (max-width: 600px) {
      main {
        padding: 0 10px;
      }

      .card {
        max-width: 100%;
      }
      
      .drawer-menu {
        width: 80%;
      }
      
      .cart-summary {
        position: static;
        top: 0;
      }
      
      .cart-item-card {
        flex-wrap: wrap;
      }
      
      .cart-item-card .item-price {
        order: 1;
        width: 100%;
        margin: 10px 0 0 0;
        text-align: right;
      }
      
      .cart-item-card .item-actions {
        order: 2;
      }
      
      .cart-item-card .item-image {
        order: 3;
      }
      
      .cart-item-card .item-details {
        order: 4;
      }
      
      /* Tables (History/Orders) */
      .history-table thead, .orders-table thead {
        display: none;
      }

      .history-table tr, .orders-table tr {
        display: block;
        margin-bottom: 10px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      }
      
      .history-table td, .orders-table td {
        display: block;
        text-align: right;
        padding: 8px 15px;
        position: relative;
      }
      
      .history-table td::before, .orders-table td::before {
        content: attr(data-label);
        position: absolute;
        left: 15px;
        font-weight: 700;
        color: var(--primary-color);
      }
      
      .history-table td:last-child, .orders-table td:last-child {
        border-bottom: none;
      }
      
      .form-group.split {
        flex-direction: column;
        gap: 0;
      }
      
      .input-group-modal {
          flex-direction: column;
          gap: 5px;
      }
    }
  </style>
</head>
<body>
  <div id="loader-bar"></div>
  <div id="toast-container"></div>
  <div id="buyNowOverlay" onclick="closeBuyNowModal()"></div>

  <header>
    <div class="header-left">
      <button id="drawer-toggle" onclick="toggleDrawer()">‚ò∞</button>
      <h1>JD MotoHub</h1>
    </div>
    <div class="header-right">
        <a href="#" class="cart-icon" onclick="showSection('cart')">üõí<span id="cart-count">0</span></a>
        <img id="header-avatar" class="profile-avatar" src="https://static-00.iconduck.com/assets.00/user-avatar-icon-512x512-nghi2896.png" alt="Profile" onclick="showSection('profile')" />
    </div>
  </header>

  <main>
    <section id="home-view" class="content-section">
      <h2 class="section-title">Available Vehicles</h2>
      
      <div class="search-filter">
        <input type="text" id="search-input" placeholder="Search by name or year..." oninput="filterAndSortVehicles()">
        <select id="type-filter" onchange="filterAndSortVehicles()">
          <option value="all">All Types</option>
          <option value="bike">Bike</option>
          <option value="car">Car</option>
          <option value="scooter">Scooter</option>
        </select>
        <select id="sort-by" onchange="filterAndSortVehicles()">
          <option value="default">Sort By (Default)</option>
          <option value="price_asc">Price (Low to High)</option>
          <option value="price_desc">Price (High to Low)</option>
          <option value="year_desc">Year (Newest)</option>
          <option value="year_asc">Year (Oldest)</option>
          <option value="km_asc">KMs (Low to High)</option>
          <option value="km_desc">KMs (High to Low)</option>
        </select>
      </div>

      <div id="vehicleGrid">
        <p style="grid-column: 1 / -1; text-align: center; color: var(--text-light);">Loading vehicles...</p>
      </div>
    </section>

    <section id="sell-view" class="content-section hidden">
      <h2 class="section-title">Sell Your Vehicle</h2>
      
      <div class="sell-form-container">
        <p style="margin-bottom: 20px; color: var(--text-light);">Fill in the details below. Your submission will be reviewed by an admin before being listed.</p>
        
        <h3>Seller Information</h3>
        <div class="form-group split">
            <div>
                <label for="sellername">Your Full Name *</label>
                <input type="text" id="sellername" required readonly style="background: #f0f0f0;">
                <span class="note">Automatically populated from your profile. Update your profile if incorrect.</span>
            </div>
            <div>
                <label for="selleremail">Email Address *</label>
                <input type="email" id="selleremail" required readonly style="background: #f0f0f0;">
                <span class="note">Used for correspondence and tracking.</span>
            </div>
        </div>
        
        <div class="form-group split">
            <div>
                <label for="sellerphone">Mobile Number *</label>
                <input type="text" id="sellerphone" required pattern="[0-9]{10,15}" title="10 to 15 digits" readonly style="background: #f0f0f0;">
                <span class="note">Required for order processing/verification.</span>
            </div>
            <div>
                <label for="selleraltphone">Alternate Phone</label>
                <input type="text" id="selleraltphone" pattern="[0-9]{0,15}">
            </div>
        </div>
        
        <div class="form-group">
            <label for="selleraddress">Your Address *</label>
            <textarea id="selleraddress" rows="3" required></textarea>
        </div>

        <hr style="margin: 30px 0;">

        <h3>Vehicle Details</h3>
        <div class="form-group">
            <label for="vname">Vehicle Name/Model *</label>
            <input type="text" id="vname" required>
        </div>
        
        <div class="form-group">
            <label for="vdescription">Description *</label>
            <textarea id="vdescription" rows="4" required placeholder="Describe the condition, features, and history of the vehicle."></textarea>
        </div>

        <div class="form-group split">
            <div>
                <label for="vtype">Type *</label>
                <select id="vtype" required>
                    <option value="bike">Bike</option>
                    <option value="car">Car</option>
                    <option value="scooter">Scooter</option>
                </select>
            </div>
            <div>
                <label for="vyear">Manufacturing Year *</label>
                <input type="number" id="vyear" min="1950" max="2024" required>
            </div>
        </div>
        
        <div class="form-group split">
            <div>
                <label for="vkm">Total Kilometers Driven *</label>
                <input type="number" id="vkm" required min="0">
            </div>
            <div>
                <label for="vprice">Expected Selling Price (‚Çπ) *</label>
                <input type="number" id="vprice" required min="1000">
            </div>
        </div>

        <hr style="margin: 30px 0;">

        <h3>Images (Max 5) *</h3>
        <div class="form-group split">
            <div>
                <label for="file-upload">Upload Photos (Max 5)</label>
                <input type="file" id="file-upload" accept="image/*" multiple onchange="handleFileSelection(event)">
                <span class="note">Select local files (converted to temporary Base64).</span>
            </div>
            <div>
                <label for="vimages">or Add Image URLs (comma separated)</label>
                <input type="text" id="vimages" placeholder="URL 1, URL 2, ...">
                <button type="button" class="action-btn cart-btn" style="margin-top: 10px; width: 100%;" onclick="addImageURLsToSelection()">Add URLs</button>
            </div>
        </div>
        
        <div class="form-group">
            <label>Current Previews</label>
            <div id="imagePreviewContainer" class="preview-grid">
                <p class="note">No images added yet.</p>
            </div>
        </div>

        <button type="button" onclick="addVehicle()">Submit Vehicle for Approval</button>
      </div>
    </section>
    
    <section id="history-view" class="content-section hidden">
      <h2 class="section-title">Your Selling History</h2>
      
      <table class="history-table">
        <thead>
          <tr>
            <th>Vehicle Name</th>
            <th>Type</th>
            <th>Your Price</th>
            <th>Final Price</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="historyTableBody">
          </tbody>
      </table>
    </section>

    <section id="cart-view" class="content-section hidden">
        <h2 class="section-title">Shopping Cart (<span id="cart-count-display">0</span> items)</h2>
        
        <div class="cart-container">
            <div class="cart-list" id="cartItemsList">
                <p class="empty-state">Loading cart...</p>
            </div>
            
            <div class="cart-summary">
                <h3>Order Summary</h3>
                <div id="cartSummary">
                     <p class="total-price-text">Total: <span>‚Çπ0</span></p>
                </div>
                <button id="checkoutButton" onclick="checkoutCart()">Proceed to Checkout</button>
            </div>
        </div>
    </section>

    <section id="order-view" class="content-section hidden">
      <h2 class="section-title">My Orders</h2>
      
      <table class="orders-table">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Vehicle</th>
            <th>Price / Loan Info</th>
            <th>Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="ordersTableBody">
          </tbody>
      </table>
    </section>
    
    <section id="profile-view" class="content-section hidden">
      <h2 class="section-title">Your Profile</h2>
      
      <div class="profile-card">
        <div class="profile-summary">
            <img id="userPhotoProfile" src="https://static-00.iconduck.com/assets.00/user-avatar-icon-512x512-nghi2896.png" alt="User Photo" />
            <div class="profile-details">
                <h3 id="userNameProfile"></h3>
                <p>Email: <span id="userEmailProfile"></span></p>
                <p>Mobile No: <span id="userPhoneProfile"></span></p>
                <p>Address: <span id="userAddressProfile"></span></p>
            </div>
        </div>
        <div class="profile-form">
          <h3>Update Information</h3>
          <label for="profile-input-name">Full Name</label>
          <input type="text" id="profile-input-name" required>
          <label for="profile-input-email">Email Address (Read-only)</label>
          <input type="email" id="profile-input-email" readonly style="background: #f0f0f0; color: #a0a0a0;">
          <label for="profile-input-phone">Mobile Number</label>
          <input type="text" id="profile-input-phone" required pattern="[0-9]{10,15}" title="10 to 15 digits">
          <span class="note">Required for placing orders.</span>
          <label for="profile-input-address">Address</label>
          <input type="text" id="profile-input-address">
          
          <button onclick="updateUserProfile()">Save Profile Changes</button>
        </div>
      </div>
    </section>
  </main>

  <div id="buyNowModal">
      <div class="modal-header">
          <h3 id="modalVehicleName">Confirm Purchase</h3>
          <button onclick="closeBuyNowModal()">‚úï</button>
      </div>
      <div class="modal-content">
          <div class="modal-price">
              Vehicle Price: <span id="modalVehiclePrice">‚Çπ0</span>
          </div>

          <div class="input-group-full-width">
              <label for="modalPaymentOption">Payment Method</label>
              <select id="modalPaymentOption">
                  <option value="emi">EMI / Loan Arrangement</option>
                  <option value="full_paid">Full Payment (Cash / Transfer)</option>
              </select>
          </div>

          <div id="emiArrangementSection" class="loan-arrangement-section">
              <h4>Loan Arrangement Details (EMI)</h4>
              <div class="input-group-modal">
                  <div>
                      <label for="modalDownPayment">Down Payment (‚Çπ)</label>
                      <input type="number" id="modalDownPayment" value="50000" min="0" oninput="updateEMICalculation()">
                  </div>
                  <div>
                      <label for="modalLoanTenure">Loan Tenure (Months)</label>
                      <select id="modalLoanTenure">
                          <option value="12">1 Year (12 Months)</option>
                          <option value="24">2 Years (24 Months)</option>
                          <option value="36" selected>3 Years (36 Months)</option>
                          <option value="48">4 Years (48 Months)</option>
                          <option value="60">5 Years (60 Months)</option>
                      </select>
                  </div>
              </div>
              <div class="input-group-modal">
                  <div>
                      <label for="modalInterestRate">Annual Interest Rate (%)</label>
                      <select id="modalInterestRate">
                          <option value="10" selected>10.0%</option>
                          <option value="12">12.0%</option>
                          <option value="14">14.0%</option>
                          <option value="16">16.0%</option>
                      </select>
                  </div>
                  <div>
                      <label>Loan Amount Remaining (‚Çπ)</label>
                      <span id="modalLoanAmountDisplay" class="input-display">‚Çπ0</span>
                  </div>
              </div>
              <div class="emi-summary">
                  <h4>Estimated Monthly EMI</h4>
                  <span id="modalMonthlyEMI" class="emi-value">‚Çπ0</span>
              </div>
          </div>
          <div class="modal-footer">
              <button id="modalConfirmOrder" onclick="confirmBuyNow()">Confirm Cash Order</button>
              <p class="modal-note">By confirming, you agree to our <a href="#" onclick="showToast('Terms & Conditions not implemented yet.', 'warning')">Terms & Conditions</a>.</p>
          </div>
      </div>
  </div>

  <div id="drawer-menu">
    <div class="drawer-header">
      <button onclick="toggleDrawer()">‚úï</button>
    </div>
    <div class="drawer-profile">
      <img id="userPhotoDrawer" src="https://static-00.iconduck.com/assets.00/user-avatar-icon-512x512-nghi2896.png" alt="User Photo" />
      <h3 id="userNameDrawer">User Name</h3>
      <p id="userEmailDrawer">user@example.com</p>
    </div>
    <div class="drawer-nav">
      <a href="#" class="nav-item active" data-section="home" onclick="showSection('home')">
        <span class="icon">üè†</span> Home
      </a>
      <a href="#" class="nav-item" data-section="cart" onclick="showSection('cart')">
        <span class="icon">üõí</span> Cart (<span id="cart-count-drawer">0</span>)
      </a>
      <a href="#" class="nav-item" data-section="order" onclick="showSection('order')">
        <span class="icon">üì¶</span> My Orders
      </a>
      <a href="#" class="nav-item" data-section="sell" onclick="showSection('sell')">
        <span class="icon">üí∞</span> Sell Vehicle
      </a>
      <a href="#" class="nav-item" data-section="history" onclick="showSection('history')">
        <span class="icon">üìú</span> Selling History
      </a>
      <a href="#" class="nav-item" data-section="profile" onclick="showSection('profile')">
        <span class="icon">üë§</span> My Profile
      </a>
    </div>
    <div class="drawer-footer">
      <button class="drawer-logout-btn" onclick="logout()">
        Log Out
      </button>
    </div>
  </div>

</body>
</html>
